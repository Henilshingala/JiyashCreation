{% extends "app/base.html" %}
{% block title %}{{ product.name }} - Jiyash{% endblock %}

{% block content %}
<div class="product-detail-container">
  <div class="product-image-section">
    {% if product.primary_image %}
    <img src="{{ product.primary_image.url }}" alt="{{ product.name }}" class="product-image">
    {% else %}
    <div class="no-image-placeholder">
      <i class="fas fa-image"></i>
      <span>No image available</span>
    </div>
    {% endif %}

    {% if product.image_2 or product.image_3 or product.image_4 or product.image_5 %}
    <div class="product-thumbnails">
      {% if product.primary_image %}
      <img src="{{ product.primary_image.url }}" alt="{{ product.title }}" class="thumbnail active">
      {% endif %}
      {% if product.image_2 %}
      <img src="{{ product.image_2.url }}" alt="{{ product.title }} - 2" class="thumbnail">
      {% endif %}
      {% if product.image_3 %}
      <img src="{{ product.image_3.url }}" alt="{{ product.title }} - 3" class="thumbnail">
      {% endif %}
      {% if product.image_4 %}
      <img src="{{ product.image_4.url }}" alt="{{ product.title }} - 4" class="thumbnail">
      {% endif %}
      {% if product.image_5 %}
      <img src="{{ product.image_5.url }}" alt="{{ product.title }} - 5" class="thumbnail">
      {% endif %}
    </div>
    {% endif %}
  </div>

  <div class="product-info-section">
    <h1 class="product-title">{{ product.title }}</h1>

    <div class="product-meta">
      {% if product.category %}
      <p class="product-category">
        <span class="meta-label">Category:</span>
        <a href="{% url 'app:category' category_type=product_type pk=product.category.id %}">{{ product.category.name }}</a>
        {% if product.subcategory %}
        → <a href="{% url 'app:subcategory' category_type=product_type pk=product.subcategory.id %}">{{ product.subcategory.name }}</a>
        {% endif %}
      </p>
      {% endif %}

      <div class="product-price">
        <span class="current-price">₹{{ product.adjusted_selling_price|default:product.selling_price }}</span>
        {% if product.discount_percentage > 0 %}
          <span class="original-price">₹{{ product.adjusted_original_price|default:product.original_price }}</span>
          <span class="discount-badge">{{ product.discount_percentage|floatformat:0 }}% OFF</span>
        {% endif %}
      </div>

      {% if product.purity %}
      <p class="product-purity">
        <span class="meta-label">Purity:</span>
        {{ product.get_purity_display }}
      </p>
      {% endif %}

      {% if product.weight %}
      <p class="product-weight">
        <span class="meta-label">Weight:</span>
        {{ product.weight }} grams
      </p>
      {% endif %}

      {% if product_type == 'gold' and product.gold_rate_per_gram %}
      <p class="gold-rate">
        <span class="meta-label">Gold Rate:</span>
        ₹{{ product.gold_rate_per_gram }}/gram
      </p>
      {% endif %}
    </div>

    <div class="product-description">
      <h3>Description</h3>
      {{ product.description|default:"No description available for this product."|linebreaks }}

      {% if product_type == 'gold' and product.making_charges %}
      <p><strong>Making Charges:</strong> ₹{{ product.making_charges }}</p>
      {% endif %}

      {% if product_type == 'imitation' %}
      {% if product.material %}
      <p><strong>Material:</strong> {{ product.material }}</p>
      {% endif %}
      {% if product.plating %}
      <p><strong>Plating:</strong> {{ product.plating }}</p>
      {% endif %}
      {% endif %}
    </div>

    <div class="product-actions">
      <div class="cart-controls">
        <div class="quantity-form">
          <button type="button" class="quantity-btn minus">-</button>
          <input type="number" name="quantity" value="1" min="1" max="10" class="quantity-input">
          <button type="button" class="quantity-btn plus">+</button>
        </div>
        <button class="add-to-cart-btn" data-product-id="{{ product.id }}"
          data-add-url="{% if product_type == 'gold' %}{% url 'app:add_to_cart_gold' product_id=product.id %}{% elif product_type == 'silver' %}{% url 'app:add_to_cart_silver' product_id=product.id %}{% elif product_type == 'imitation' %}{% url 'app:add_to_cart_imitation' product_id=product.id %}{% else %}{% url 'app:add_to_cart' product_id=product.id %}{% endif %}">
          <i class="fas fa-shopping-cart"></i>
          Add to Cart
        </button>
      </div>
      <div class="wishlist-wrapper">
        <a href="{% url 'app:add_to_wishlist' product_type=product_type pk=product.id %}"
          class="wishlist-btn {% if is_in_wishlist %}active{% endif %}"
          title="{% if is_in_wishlist %}Remove from Wishlist{% else %}Add to Wishlist{% endif %}">
          <i class="{% if is_in_wishlist %}fas{% else %}far{% endif %} fa-heart"></i>
        </a>
      </div>
    </div>

    <div class="product-meta-footer">
      <div class="meta-item">
        <i class="fas fa-shield-alt"></i>
        <span>Authenticity Guaranteed</span>
      </div>
      <div class="meta-item">
        <i class="fas fa-sync-alt"></i>
        <span>7-Day Easy Returns</span>
      </div>
      <div class="meta-item">
        <i class="fas fa-truck"></i>
        <span>Free Shipping</span>
      </div>
    </div>
  </div>
</div>
<style>
  /* Animations */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes subtlePop {
    0% {
      transform: scale(.98);
    }

    100% {
      transform: scale(1);
    }
  }

  .product-detail-container {
    /* Local theme for this page */
    --accent: var(--primary-color);
    --accent-2: #89c9a3;
    --muted: #64748b;
    --bg-soft: #f8fafc;
    --ring: rgba(45, 90, 61, 0.15);
    --shadow: 0 10px 30px rgba(2, 6, 23, 0.08);
    --shadow-hover: 0 16px 40px rgba(2, 6, 23, 0.12);
    max-width: 1200px;
    margin: 40px auto;
    padding: 24px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    background: #ffffff;
    border-radius: 16px;
    box-shadow: var(--shadow);
    animation: fadeInUp .5s ease both;
  }

  .product-image-section {
    position: relative;
  }

  .product-image {
    width: 100%;
    height: auto;
    max-height: 520px;
    object-fit: contain;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    transition: transform .35s ease, opacity .15s ease;
  }

  .product-image-section:hover .product-image {
    transform: scale(1.01);
  }

  .product-thumbnails {
    margin-top: 14px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 12px;
  }

  .product-thumbnails .thumbnail {
    width: 100%;
    height: 120px;
    object-fit: cover;
    border-radius: 8px;
    border: 2px solid transparent;
    background: #f1f5f9;
    cursor: pointer;
    transition: border-color .2s ease, transform .2s ease, box-shadow .2s ease;
  }

  .product-thumbnails .thumbnail:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 14px rgba(0, 0, 0, .08);
  }

  .product-thumbnails .thumbnail.active {
    border-color: var(--primary-color);
  }

  .product-info-section {
    padding: 20px 0;
  }

  .product-title {
    font-size: 32px;
    font-weight: 800;
    color: var(--accent);
    margin-bottom: 10px;
    line-height: 1.2;
  }

  .product-meta {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 14px;
  }

  .product-category {
    margin-bottom: 20px;
    font-size: 16px;
  }

  .category-label {
    color: #6c757d;
    font-weight: 500;
  }

  .category-name {
    color: var(--accent);
    font-weight: 600;
  }

  .product-category a {
    color: var(--accent);
    text-decoration: none;
    border-bottom: 1px dashed rgba(45, 90, 61, .25);
  }

  .product-category a:hover {
    color: #1e3d28;
    border-color: #1e3d28;
  }

  .product-price {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 24px;
  }

  .current-price {
    font-size: 28px;
    font-weight: 800;
    color: #b91c1c;
    letter-spacing: .2px;
  }

  .original-price {
    font-size: 20px;
    font-weight: 600;
    color: #6b7280;
    text-decoration: line-through;
    opacity: 0.8;
  }

  .discount-badge {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
  }

  /* Stronger specificity to ensure it applies */
  .product-info-section .product-description {
    position: relative;
    font-size: 16px;
    line-height: 1.7;
    color: #334155;
    margin-bottom: 32px;
    padding: 22px 24px 22px 24px;
    background: linear-gradient(180deg, var(--bg-soft) 0%, #eef2f7 100%);
    border-radius: 12px;
    border-left: 6px solid var(--accent);
    box-shadow: 0 6px 16px rgba(2, 6, 23, 0.06);
    animation: subtlePop .25s ease-out both;
  }

  .product-info-section .product-description h3 {
    margin-bottom: 10px;
    color: var(--accent);
  }

  .product-info-section .product-description p {
    margin: 8px 0;
  }

  .product-actions {
    display: flex;
    flex-direction: column;
    gap: 16px;
    align-items: stretch;
  }

  .wishlist-btn {
    background: #fff;
    border: 2px solid #e2e8f0;
    color: #64748b;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.25s ease;
    box-shadow: 0 4px 12px rgba(2, 6, 23, 0.06);
  }

  .wishlist-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(45, 90, 61, 0.06);
    transform: translateY(-2px);
  }

  .wishlist-btn.active {
    background: #dc3545;
    color: #fff;
    border-color: #dc3545;
    box-shadow: 0 8px 18px rgba(220, 53, 69, .35);
  }

  .wishlist-btn.active:hover {
    background: #c82333;
    border-color: #c82333;
  }

  @media (max-width: 768px) {
    .product-detail-container {
      grid-template-columns: 1fr;
      gap: 24px;
      margin: 20px auto;
      padding: 16px;
    }

    .product-title {
      font-size: 24px;
    }

    .current-price {
      font-size: 24px;
    }

    .original-price {
      font-size: 18px;
    }

    .discount-badge {
      font-size: 12px;
      padding: 3px 10px;
    }

    .product-info-section .product-description {
      padding: 16px;
    }

    .wishlist-btn {
      width: 50px;
      height: 50px;
    }
  }

  @media (max-width: 480px) {
    .product-detail-container {
      margin: 10px;
      padding: 12px;
    }
    .product-title {
      font-size: 20px;
    }
    .current-price {
      font-size: 20px;
    }
    .original-price {
      font-size: 16px;
    }
    .discount-badge {
      font-size: 11px;
      padding: 2px 8px;
    }
    .product-price {
      gap: 8px;
    }
    .product-actions {
      flex-direction: column;
      align-items: stretch;
      gap: 12px;
    }
    .wishlist-btn {
      align-self: center;
      padding: 0;
    }
    .cart-controls {
      flex-direction: column;
      gap: 12px;
    }
    .quantity-form {
      justify-content: center;
    }
  }

  .cart-controls {
    display: flex;
    flex-direction: column;
    gap: 16px;
    align-items: stretch;
  }

  .quantity-form {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: #f8f9fa;
    padding: 8px;
    border-radius: 8px;
  }

  .quantity-btn {
    width: 36px;
    height: 36px;
    border: 1px solid #ddd;
    background: #fff;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 18px;
    transition: all .2s ease;
  }

  .quantity-btn:hover {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent);
  }

  .quantity-input {
    width: 60px;
    height: 36px;
    text-align: center;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 16px;
    font-weight: 600;
  }

  .add-to-cart-btn {
    background: linear-gradient(135deg, var(--accent) 0%, #1e3d28 100%);
    color: #fff;
    border: none;
    padding: 16px 32px;
    border-radius: 50px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.25s ease;
    box-shadow: 0 6px 18px rgba(45, 90, 61, 0.3);
  }

  .add-to-cart-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 26px rgba(45, 90, 61, 0.4);
    background: linear-gradient(135deg, #1e3d28 0%, #0f1f14 100%);
  }

  .add-to-cart-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .wishlist-wrapper {
    display: flex;
    justify-content: center;
  }

  .update-btn {
    background: var(--accent);
    color: #fff;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: background .3s ease;
  }

  .update-btn:hover {
    background: #1e3d28;
  }

  .remove-cart-btn {
    color: #dc3545;
    text-decoration: none;
    font-size: 14px;
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid #dc3545;
    transition: all .25s ease;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .remove-cart-btn:hover {
    background: #dc3545;
    color: #fff;
  }

  .login-prompt-btn {
    background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
    color: #fff;
    text-decoration: none;
    padding: 16px 32px;
    border-radius: 50px;
    font-size: 16px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all .25s ease;
    box-shadow: 0 6px 18px rgba(108, 117, 125, 0.3);
  }

  .login-prompt-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 26px rgba(108, 117, 125, 0.4);
    background: linear-gradient(135deg, #495057 0%, #343a40 100%);
  }

  /* Meta footer chips */
  .product-meta-footer {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
    margin-top: 18px;
  }

  .product-meta-footer .meta-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 12px;
    background: #f1f5f9;
    color: #0f172a;
    border: 1px solid rgba(2, 6, 23, 0.06);
  }

  .product-meta-footer .meta-item i {
    color: var(--accent);
  }

  @media (min-width: 769px) and (max-width: 1200px) {
    .product-detail-container {
      max-width: 900px;
      gap: 30px;
    }

    .product-title {
      font-size: 28px;
    }

    .product-price {
      font-size: 24px;
    }
  }

  @media (min-width: 1201px) {
    .product-detail-container {
      max-width: 1200px;
      gap: 40px;
    }

    .product-actions {
      flex-direction: row;
      gap: 16px;
    }

    .wishlist-btn {
      flex: 0 0 auto;
    }
  }
</style>
<script>
  // AJAX wishlist toggle without page reload
  document.addEventListener('DOMContentLoaded', function () {
    const btn = document.querySelector('.wishlist-btn');
    if (!btn) return;

    function getJwtToken() {
      try { return localStorage.getItem('jwt_token'); } catch (_) { return null; }
    }

    async function postToggle(url) {
      const token = getJwtToken();
      if (!token) {
        // No JWT available; send to login with next
        window.location.href = "{% url 'app:login' %}?next={{ request.path|urlencode }}";
        throw new Error('No JWT');
      }
      const resp = await fetch(url, {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + token,
          'X-Requested-With': 'XMLHttpRequest'
        }
      });
      if (resp.status === 401) {
        window.location.href = "{% url 'app:login' %}?next={{ request.path|urlencode }}";
        throw new Error('Unauthorized');
      }
      if (!resp.ok) throw new Error('Network error');
      return resp.json();
    }

    btn.addEventListener('click', async function (e) {
      // Only intercept left-click and non-modified clicks
      if (e.button !== 0 || e.metaKey || e.ctrlKey || e.shiftKey || e.altKey) return;
      e.preventDefault();
      const href = btn.getAttribute('href');
      if (!href) return;
      try {
        btn.classList.add('loading');
        const data = await postToggle(href);
        // Toggle UI based on server response
        const icon = btn.querySelector('i');
        if (data && data.in_wishlist === true) {
          btn.classList.add('active');
          if (icon) { icon.classList.remove('far'); icon.classList.add('fas'); }
          // Update href to remove endpoint
          btn.setAttribute('href', `{% url 'app:remove_from_wishlist' product_type=product_type pk=product.id %}`);
        } else if (data && data.in_wishlist === false) {
          btn.classList.remove('active');
          if (icon) { icon.classList.remove('fas'); icon.classList.add('far'); }
          // Update href to add endpoint
          btn.setAttribute('href', `{% url 'app:add_to_wishlist' product_type=product_type pk=product.id %}`);
        }
      } catch (err) {
        // On error, fallback to normal navigation
        window.location.href = href;
      } finally {
        btn.classList.remove('loading');
      }
    });
  });

  // Cart quantity AJAX update matching JSON body expected by view
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('.quantity-form');
    const minus = form ? form.querySelector('.minus') : null;
    const plus = form ? form.querySelector('.plus') : null;
    const qty = form ? form.querySelector('input[name="quantity"]') : null;
    const updateBtn = form ? form.querySelector('.js-update-cart') : null;

    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }

    function setVal(v) { if (!qty) return; qty.value = Math.max(1, parseInt(v || 1, 10)); }
    if (minus && qty) minus.addEventListener('click', () => setVal((parseInt(qty.value || 1, 10) - 1)));
    if (plus && qty) plus.addEventListener('click', () => setVal((parseInt(qty.value || 1, 10) + 1)));

    async function postJSON(url, body) {
      const token = localStorage.getItem('jwt_token');
      if (!token) {
        alert('Please login to add items to cart');
        window.location.href = '/login/?next=' + encodeURIComponent(window.location.href);
        return;
      }

      fetch(`/cart/add/${productId}/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token,
          'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({ quantity: quantity })
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            // Update cart count in header
            const cartCountEl = document.getElementById('cartCount');
            if (cartCountEl && data.cart_count !== undefined) {
              cartCountEl.textContent = data.cart_count;
            }

            // Show success message
            alert(data.message || 'Product added to cart!');

            // Redirect to cart page
            window.location.href = '/cart/';
          } else {
            if (data.redirect) {
              // Authentication required - redirect to login
              alert(data.message || 'Please login to add items to cart');
              window.location.href = data.redirect;
            } else {
              alert(data.message || 'Failed to add product to cart');
            }
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred while adding to cart');
        });
    }
  });

  // Add to Cart functionality
  document.addEventListener('DOMContentLoaded', function () {
    const addToCartBtn = document.querySelector('.add-to-cart-btn');
    const quantityInput = document.querySelector('.quantity-input');
    const minusBtn = document.querySelector('.quantity-btn.minus');
    const plusBtn = document.querySelector('.quantity-btn.plus');

    // Quantity controls
    if (minusBtn && quantityInput) {
      minusBtn.addEventListener('click', function () {
        const currentValue = parseInt(quantityInput.value) || 1;
        if (currentValue > 1) {
          quantityInput.value = currentValue - 1;
        }
      });
    }

    if (plusBtn && quantityInput) {
      plusBtn.addEventListener('click', function () {
        const currentValue = parseInt(quantityInput.value) || 1;
        const maxValue = parseInt(quantityInput.getAttribute('max')) || 10;
        if (currentValue < maxValue) {
          quantityInput.value = currentValue + 1;
        }
      });
    }

    // Add to cart functionality
    if (addToCartBtn) {
      addToCartBtn.addEventListener('click', async function () {
        const token = localStorage.getItem('jwt_token');
        if (!token) {
          window.location.href = "{% url 'app:login' %}?next={{ request.path|urlencode }}";
          return;
        }

        const productId = this.getAttribute('data-product-id');
        const addUrl = this.getAttribute('data-add-url');
        const quantity = parseInt(quantityInput.value) || 1;

        // Disable button during request
        this.disabled = true;
        const originalText = this.innerHTML;
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';

        try {
          const response = await fetch(addUrl, {
            method: 'POST',
            headers: {
              'Authorization': 'Bearer ' + token,
              'Content-Type': 'application/json',
              'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({ quantity: quantity })
          });

          if (response.status === 401) {
            window.location.href = "{% url 'app:login' %}?next={{ request.path|urlencode }}";
            return;
          }

          const data = await response.json();

          if (data.success) {
            // Show success message
            showNotification(data.message, 'success');

            // Update cart count in header immediately
            if (window.updateCartCount) {
              window.updateCartCount().then(() => {
                // Redirect to cart page after cart count is updated
                setTimeout(() => {
                  window.location.href = '/cart/';
                }, 800);
              });
            } else {
              // Fallback redirect if updateCartCount is not available
              setTimeout(() => {
                window.location.href = '/cart/';
              }, 800);
            }
          } else {
            showNotification(data.message || 'Failed to add to cart', 'error');
          }
        } catch (error) {
          console.error('Add to cart error:', error);
          showNotification('Failed to add to cart', 'error');
        } finally {
          // Re-enable button
          this.disabled = false;
          this.innerHTML = originalText;
        }
      });
    }

    function updateCartCount(count) {
      const cartCountElements = document.querySelectorAll('.cart-count, .header-cart-count');
      cartCountElements.forEach(element => {
        element.textContent = count;
        if (count > 0) {
          element.style.display = 'inline';
          // Add pop animation
          element.style.transform = 'scale(1.2)';
          setTimeout(() => {
            element.style.transform = 'scale(1)';
          }, 200);
        }
      });
    }

    function showNotification(message, type = 'success') {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.innerHTML = `
      <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
      <span>${message}</span>
    `;

      // Add styles
      notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: ${type === 'success' ? '#10b981' : '#ef4444'};
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 10000;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    `;

      document.body.appendChild(notification);

      // Animate in
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);

      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }
  });

  // Interactive Image Gallery
  document.addEventListener('DOMContentLoaded', function () {
    const mainImage = document.querySelector('.product-image');
    const thumbnails = document.querySelectorAll('.thumbnail');

    if (!mainImage || thumbnails.length === 0) return;

    thumbnails.forEach(thumbnail => {
      thumbnail.addEventListener('click', function () {
        // Get clicked thumbnail src
        const clickedSrc = this.src;

        // Don't do anything if clicking the same image
        if (mainImage.src === clickedSrc) return;

        // Add fade effect to main image
        mainImage.style.opacity = '0';

        setTimeout(() => {
          // Only change the main image, don't swap
          mainImage.src = clickedSrc;

          // Update active state
          thumbnails.forEach(thumb => thumb.classList.remove('active'));
          this.classList.add('active');

          // Fade back in
          mainImage.style.opacity = '1';
        }, 150);
      });
    });
  });
</script>
{% endblock %}    